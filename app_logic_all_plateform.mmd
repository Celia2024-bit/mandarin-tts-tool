
flowchart TD
  %% Architecture: cross-platform UI/controller/audio player layers

  %% Packages
  subgraph interface[interface/]
    A1["AudioPlayerBase\n(abstract)"]
    A2["UIBase\n(abstract)"]
  end

  subgraph core[core/]
    C1["AppController\n(logic + state)"]
    C2["TTSEngine\n(TTS + cache)"]
  end

  subgraph factory[platform_factory/]
    F1["create_audio_player()\n(factory)"]
  end

  subgraph desktop[platforms/desktop/]
    D1["TkinterUI\n(UIBase impl)"]
    D2["PygameAudioPlayer\n(Audio impl)"]
  end

  subgraph mobiles[platforms/mobiles/]
    M1["MobileUI (Kivy/BeeWare)\n(UIBase impl)"]
    M2["AndroidAudioPlayer\n(Audio impl)"]
    M3["IOSAudioPlayer\n(Audio impl)"]
  end

  %% Dependencies / contracts
  A1 -->|contract| D2
  A1 -->|contract| M2
  A1 -->|contract| M3
  A2 -->|contract| D1
  A2 -->|contract| M1

  F1 --> D2
  F1 --> M2
  F1 --> M3

  D1 -->|callbacks| C1
  M1 -->|callbacks| C1

  C1 -->|uses| C2
  C1 -->|creates| F1

  %% Data & control flows
  D1 -->|on_click_process / ocr / play / pause / stop| C1
  M1 -->|on_click_* / on_change_*| C1

  C1 -->|on_status / on_sentences_ready / on_buttons_update / on_mode_change| D1
  C1 -->|callbacks| M1

  C1 -->|generate_full / generate_single| C2
  C2 -->|returns: audio_path| C1
  C1 -->|play / pause / resume / stop| D2
  C1 -->|play / pause / resume / stop| M2
  C1 -->|play / pause / resume / stop| M3

  %% Filesystem/cache
  subgraph cache[audio_cache/]
    X1["full_*.mp3 / .wav"]
    X2["single_*.mp3 / .wav"]
  end

  C2 --> X1
  C2 --> X2
