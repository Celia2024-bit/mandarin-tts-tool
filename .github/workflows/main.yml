name: Build Windows + Mac Installers

on: workflow_dispatch  # 手动触发

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller edge-tts pygame baidu-aip
          
      - name: Build Windows EXE
        run: |
          pyinstaller -F -w ./mandarinTtsTool.py --name "MandarinTTS-Windows"
      
      - name: Upload Windows EXE
        uses: actions/upload-artifact@v4
        with:
          name: MandarinTTS-Windows
          path: dist/MandarinTTS-Windows.exe

  build-mac:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: Install Mac 系统依赖（仅修复这一步！）
        run: |
          # 关键修复：brew 没有 pygame，改用 pip 安装，只保留 python-tk（GUI 依赖）
          brew install python-tk
          
      - name: Install Python 依赖（保留这一步，确保 pygame 安装成功）
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller edge-tts pygame baidu-aip
          
      - name: Build Mac 可执行文件
        run: |
          # 打包成 Mac 专用的.app 文件（去掉 -F 单文件参数，Mac 更稳定）
          pyinstaller -w ./mandarinTtsTool.py --name "MandarinTTS-Mac"
          
          # 生成 DMG 镜像（路径修正：指向.app 文件夹，之前可能漏了 .app 后缀）
          hdiutil create -volname "MandarinTTS" -srcfolder "dist/MandarinTTS-Mac.app" -ov -format UDZO MandarinTTS-Mac.dmg
      
      - name: Upload Mac DMG
        uses: actions/upload-artifact@v4
        with:
          name: MandarinTTS-Mac
          path: MandarinTTS-Mac.dmg
